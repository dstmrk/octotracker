services:
  octotracker:
    # PRODUZIONE: Usa immagine pre-built da GitHub Container Registry
    # Decommenta la riga seguente e commenta "build:" per usare immagine da GHCR
    image: ghcr.io/dstmrk/octotracker:latest

    # SVILUPPO: Build locale
    # Commenta "image:" sopra e decommenta "build:" per build locale
    # build: .

    container_name: octotracker
    restart: unless-stopped
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHANNEL=${TELEGRAM_CHANNEL:-}
      - WEBHOOK_URL=${WEBHOOK_URL:-}
      - WEBHOOK_PORT=${WEBHOOK_PORT:-8443}
      # WEBHOOK_SECRET: OBBLIGATORIO per sicurezza (protezione da webhook spoofing)
      # Genera con: python -c 'import secrets; print(secrets.token_urlsafe(32))'
      - WEBHOOK_SECRET=${WEBHOOK_SECRET}
      - HEALTH_PORT=${HEALTH_PORT:-8444}
      - SCRAPER_HOUR=${SCRAPER_HOUR:-11}
      - CHECKER_HOUR=${CHECKER_HOUR:-12}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - TZ=Europe/Rome
    ports:
      - "8443:8443"  # Webhook Telegram
      - "8444:8444"  # Health check endpoint
    volumes:
      # Volume per persistenza dati
      - ./data:/app/data
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
